<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="shar">
<title>Analysing the climatic niche of Cormus domestica • shar</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysing the climatic niche of Cormus domestica">
<meta property="og:description" content="shar">
<meta property="og:image" content="https://r-spatialecology.github.io/shar/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">shar</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/get_started.html">
    <span class="fa fa fa fa-magic"></span>
     
    Get Started
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">
    <span class="fa fa-gears"></span>
     
    Functions
  </a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../articles/background.html">
    <span class="fa fa-book"></span>
     
    General Background
  </a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown--more">
    <span class="fa fa-graduation-cap"></span>
     
    More
  </a>
  <div class="dropdown-menu" aria-labelledby="dropdown--more">
    <a class="dropdown-item" href="../articles/parallelization.html">
      <span class="fa fa-book"></span>
       
      Parallelization
    </a>
    <a class="dropdown-item" href="../articles/reconstruct_several_patterns.html">
      <span class="fa fa-book"></span>
       
      Reconstruct several patterns
    </a>
    <a class="dropdown-item" href="../articles/reconstruct_multi_patterns.html">
      <span class="fa fa-book"></span>
       
      Multi-trait pattern reconstruction
    </a>
    <a class="dropdown-item" href="../articles/cormus_domestica_tmp.html">
      <span class="fa fa-book"></span>
       
      Analysing the climatic niche of Cormus domestica
    </a>
    <a class="dropdown-item" href="../articles/publication_record.html">
      <span class="fa fa-file-text-o"></span>
       
      Publication Record
    </a>
    <a class="external-link dropdown-item" href="https://doi.org/10.21105/joss.03811">
      <span class="fa fa-file-text-o"></span>
       
      JOSS Publication
    </a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">
    <span class="fa fa-newspaper-o"></span>
     
    News
  </a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/r-spatialecology/shar/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
<li class="nav-item">
  <a class="external-link nav-link" href="https://www.maxhesselbarth.com">
    <span class="fa fa-user"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Analysing the climatic niche of Cormus domestica</h1>
                        <h4 data-toc-skip class="author">Zeke
Marshall</h4>
            
            <h4 data-toc-skip class="date">2023-12-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/r-spatialecology/shar/blob/HEAD/vignettes/articles/cormus_domestica_tmp.Rmd" class="external-link"><code>vignettes/articles/cormus_domestica_tmp.Rmd</code></a></small>
      <div class="d-none name"><code>cormus_domestica_tmp.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="outline">Outline<a class="anchor" aria-label="anchor" href="#outline"></a>
</h2>
<p>This vignette demonstrates how to use <code>shar</code> to analyse
species occurrence data obtained from the Global Biodiversity
Information Facility <a href="https://www.gbif.org" class="external-link">(GBIF)</a> and
environmental raster data obtained from the Climate Research Unit <a href="https://www.uea.ac.uk/groups-and-centres/climatic-research-unit" class="external-link">(CRU)</a>
entirely in <code>R</code>. The “Gamma test” approach as detailed in the
<code><a href="../articles/background.html">vignette("background")</a></code> is used. The distribution of the
tree species <em>Cormus domestica</em> in Europe is selected, a tree
which tolerates a wide range of conditions but favors warm to mild
climates, occurring in the “Subtropical dry forest” and “Temperate
Continental” FAO ecological zones. <em>Cormus domestica</em> is most
commonly found in Southern Europe, though there it’s natural range is
uncertain owing to it’s cultivation and distribution by the Roman Empire
(De Rigo et al., 2016; Rotach, 2003).</p>
</div>
<div class="section level2">
<h2 id="load-required-packages">Load required packages<a class="anchor" aria-label="anchor" href="#load-required-packages"></a>
</h2>
<p>This article of the package requires the <code>getCRUCLdata</code>
package, which is not available on CRAN anymore. To install the package,
please run
<code>install.packages('getCRUCLdata', repos = 'http://packages.ropensci.org', typ = 'source')</code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span> <span class="co"># For data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/getCRUCLdata/" class="external-link">getCRUCLdata</a></span><span class="op">)</span> <span class="co"># For retrieving climate raster data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span> <span class="co"># For plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co"># For composing multiple plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif" class="external-link">rgbif</a></span><span class="op">)</span> <span class="co"># For retrieving species occurrence data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span> <span class="co"># For retrieving geographical data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ropenscilabs/rnaturalearthdata" class="external-link">rnaturalearthdata</a></span><span class="op">)</span> <span class="co"># For retrieving geographical data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span> <span class="co"># For spatial data operations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://spatstat.org/" class="external-link">spatstat</a></span><span class="op">)</span> <span class="co"># For spatial point pattern analysis</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span> <span class="co"># For spatial data operations</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatialecology.github.io/shar/">shar</a></span><span class="op">)</span> <span class="co"># For species-habitat association analysis</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-occurrence-data">Download occurrence data<a class="anchor" aria-label="anchor" href="#download-occurrence-data"></a>
</h2>
<p>To retrieve species occurrence data the <code>R</code> package
<code>rgbif</code> (Chamberlain &amp; Boettiger, 2017) is used, which
provides an interface to access the GBIF database. For this vignette we
are interested in observations within the likely natural distribution of
Cormus domestica, which includes Europe, the wider Mediterranean, the
Black Sea Region, and potentially North Africa.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve key for Cormus domestica</span></span>
<span><span class="va">key</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/name_backbone.html" class="external-link">name_backbone</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Cormus domestica'</span>, kingdom <span class="op">=</span> <span class="st">'plants'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Establish region of interest</span></span>
<span><span class="va">roi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">20</span>, xmax <span class="op">=</span> <span class="fl">45</span>, ymin <span class="op">=</span> <span class="fl">30</span>, ymax <span class="op">=</span> <span class="fl">73</span><span class="op">)</span></span>
<span><span class="va">roi_bbox</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">roi</span>, crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:4326"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">roi_sfc</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sfc.html" class="external-link">st_sfc</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">roi</span><span class="op">[[</span><span class="st">"xmin"</span><span class="op">]</span><span class="op">]</span>, <span class="va">roi</span><span class="op">[[</span><span class="st">"ymin"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                      <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st.html" class="external-link">st_point</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">roi</span><span class="op">[[</span><span class="st">"xmax"</span><span class="op">]</span><span class="op">]</span>, <span class="va">roi</span><span class="op">[[</span><span class="st">"ymax"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                      crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Retrieve occurrences for the region of interest</span></span>
<span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_search.html" class="external-link">occ_search</a></span><span class="op">(</span>taxonKey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">key</span><span class="op">$</span><span class="va">usageKey</span><span class="op">)</span>, limit <span class="op">=</span> <span class="fl">99999</span>, </span>
<span>                         geometry <span class="op">=</span> <span class="va">roi_bbox</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a simple data frame containing only the unique identifier (id),</span></span>
<span><span class="co"># latitude (lat), and longtitude (lon).</span></span>
<span><span class="va">data_simp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>id <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">key</span>, </span>
<span>                        lat <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">decimalLatitude</span>, lon <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">data</span><span class="op">$</span><span class="va">decimalLongitude</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lat</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">lon</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-map-data">Download map data<a class="anchor" aria-label="anchor" href="#download-map-data"></a>
</h2>
<p>Spatial polygon data for the world is obtained from the
<code>rnaturalearth</code> package (South, 2022), the map is then
restricted to the region of interest. The <code>spatstat</code> package
requires geospatial data in the format of a projected coordinate system;
the data is therefore converted from the geographic coordinate system <a href="https://epsg.io/4326" class="external-link">4336</a> to the projected coordinate system
<a href="https://epsg.io/3395" class="external-link">3395</a>. The <code>shar</code> function
<code>fit_point_process</code> requires a spatial point pattern
(<code>ppp</code>) object bounded within an observation window of the
class <code>owin</code>, which is then created.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve data from rnaturalearth</span></span>
<span><span class="va">worldmap</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_countries.html" class="external-link">ne_countries</a></span><span class="op">(</span>returnclass <span class="op">=</span> <span class="st">"sf"</span>, scale <span class="op">=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:3395"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Re-project simple features region of interest</span></span>
<span><span class="va">roi_sfc_3395</span> <span class="op">&lt;-</span> <span class="va">roi_sfc</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:3395"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Crop world map to include polygons within the region of interest</span></span>
<span><span class="va">roi_map</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">worldmap</span>, y <span class="op">=</span> <span class="va">roi_sfc_3395</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define observation window</span></span>
<span><span class="va">roi_owin</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/as.owin.html" class="external-link">as.owin</a></span><span class="op">(</span><span class="va">roi_map</span><span class="op">$</span><span class="va">geometry</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="download-climate-data">Download climate data<a class="anchor" aria-label="anchor" href="#download-climate-data"></a>
</h2>
<p>The environmental variable selected for demonstrative purposes is the
mean temperature in January over the 1961-1990 period. Data is obtained
through the <code>getCRUCLdata</code> package (Sparks, 2017) which
provides access to the datasets described in New et al. (2002).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Download data as a raster brick through the getCRUCLdata package</span></span>
<span><span class="co"># Mean temperature (tmn) data should be 180.4MB</span></span>
<span><span class="va">cru_data</span> <span class="op">&lt;-</span> <span class="fu">getCRUCLdata</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/getCRUCLdata/reference/get_CRU_stack.html" class="external-link">get_CRU_stack</a></span><span class="op">(</span>tmp <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Select temperature variable and the month of January</span></span>
<span><span class="va">tmp_raster</span> <span class="op">&lt;-</span> <span class="va">cru_data</span><span class="op">$</span><span class="va">tmp</span><span class="op">$</span><span class="va">jan</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="prepare-landscape-raster">Prepare landscape raster<a class="anchor" aria-label="anchor" href="#prepare-landscape-raster"></a>
</h2>
<p>The climate data obtained above is restricted to the region of
interest, then classified into 10 habitats based on temperature ranges,
achieved by setting the lower and upper bounds of these ranges in the
<code>fixedBreaks</code> argument of the <code>classify_habitats</code>
function. Figure 1 displays the unclassified and classified habitat.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Crop tmp raster</span></span>
<span><span class="va">tmp_raster_eur</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tmp_raster</span>, y <span class="op">=</span> <span class="va">roi</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Project raster to EPSG:3395</span></span>
<span><span class="va">tmp_raster_eur_3395</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/terra/man/project.html" class="external-link">project</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">tmp_raster_eur</span>, y <span class="op">=</span> <span class="st">"EPSG:3395"</span>, </span>
<span>                                      method <span class="op">=</span> <span class="st">"bilinear"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Classify landscape</span></span>
<span><span class="va">landscape_classified</span> <span class="op">&lt;-</span> <span class="fu">shar</span><span class="fu">::</span><span class="fu"><a href="../reference/classify_habitats.html">classify_habitats</a></span><span class="op">(</span>raster <span class="op">=</span> <span class="va">tmp_raster_eur_3395</span>,</span>
<span>                                                return_breaks <span class="op">=</span> <span class="cn">TRUE</span>, style <span class="op">=</span> <span class="st">"fixed"</span>,</span>
<span>                                                fixedBreaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">20</span>, <span class="op">-</span><span class="fl">10</span>, <span class="op">-</span><span class="fl">7.5</span>, <span class="op">-</span><span class="fl">5</span>, <span class="op">-</span><span class="fl">2.5</span>, </span>
<span>                                                                <span class="fl">0</span>, <span class="fl">2.5</span>, <span class="fl">5</span>, <span class="fl">7.5</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="cormus_domestica_tmp_files/figure-html/land_plots-1.png" alt="Figure 1 - The mean temperature in January over the 1961-1990 period on a continuous scale (left) and classified in to ten discrete categories (right)." width="100%"><p class="caption">
Figure 1 - The mean temperature in January over the 1961-1990 period on
a continuous scale (left) and classified in to ten discrete categories
(right).
</p>
</div>
</div>
<div class="section level2">
<h2 id="prepare-occurrence-data">Prepare occurrence data<a class="anchor" aria-label="anchor" href="#prepare-occurrence-data"></a>
</h2>
<p>The occurrence data is prepared, then the <code>shar</code> function
<code>fit_point_process</code> is called, yielding the randomized
occurrence data within the observation window as required by the
<code>results_habitat_association</code> function. Figure 2 displays the
real and randomised occurrence data.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert occurrence data to a simple features object</span></span>
<span><span class="va">data_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="va">data_simp</span>, coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lon"</span>, <span class="st">"lat"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Re-project the occurrence data</span></span>
<span><span class="va">data_sf_3395</span> <span class="op">&lt;-</span> <span class="va">data_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>crs <span class="op">=</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crs.html" class="external-link">st_crs</a></span><span class="op">(</span><span class="st">"EPSG:3395"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the coordinates as a matrix from the sf occurrences object</span></span>
<span><span class="va">data_sf_coords</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_coordinates.html" class="external-link">st_coordinates</a></span><span class="op">(</span><span class="va">data_sf_3395</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a spatial points pattern object containing the occurrence data</span></span>
<span><span class="va">data_sf_ppp</span> <span class="op">&lt;-</span> <span class="fu">spatstat.geom</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spatstat.geom/man/as.ppp.html" class="external-link">as.ppp</a></span><span class="op">(</span>X <span class="op">=</span> <span class="va">data_sf_coords</span>, W <span class="op">=</span> <span class="va">roi_owin</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fit point pattern process to data</span></span>
<span><span class="va">rand_pattern</span> <span class="op">&lt;-</span> <span class="fu">shar</span><span class="fu">::</span><span class="fu"><a href="../reference/fit_point_process.html">fit_point_process</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="va">data_sf_ppp</span>, n_random <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="cormus_domestica_tmp_files/figure-html/occ_plots-1.png" alt="Figure 2 - Real (left) and randomised (right) occurrences of Cormus domestica." width="100%"><p class="caption">
Figure 2 - Real (left) and randomised (right) occurrences of Cormus
domestica.
</p>
</div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<p>The analysis function <code>results_habitat_association</code> is
then called. The results of the analysis show that <em>Cormus
domestica</em> is positively associated with locations which experience
a mean January temperature of -2.5C - 10C (habitats 5, 6, 7, 8, and 9).
Furthermore, <em>Cormus domestica</em> is negatively associated with all
other habitats classified by temperature.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Establish significance level</span></span>
<span><span class="va">sig_level</span> <span class="op">&lt;-</span> <span class="fl">0.01</span></span>
<span></span>
<span><span class="co"># Run analysis</span></span>
<span><span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">shar</span><span class="fu">::</span><span class="fu"><a href="../reference/results_habitat_association.html">results_habitat_association</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="va">rand_pattern</span>, </span>
<span>                                             raster <span class="op">=</span> <span class="va">landscape_classified</span><span class="op">$</span><span class="va">raster</span>,</span>
<span>                                             breaks <span class="op">=</span> <span class="va">landscape_classified</span><span class="op">$</span><span class="va">breaks</span>,</span>
<span>                                             significance_level <span class="op">=</span> <span class="va">sig_level</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">habitat</span><span class="op">)</span></span>
<span></span>
<span><span class="va">results</span></span>
<span><span class="co">#&gt;    habitat     breaks count      lo      hi significance</span></span>
<span><span class="co">#&gt; 1        1  [-20,-10)     1 8932.90 9207.08     negative</span></span>
<span><span class="co">#&gt; 2        2 [-10,-7.5)     0 2933.77 3163.84     negative</span></span>
<span><span class="co">#&gt; 3        3  [-7.5,-5)    11 3252.52 3418.10     negative</span></span>
<span><span class="co">#&gt; 4        4  [-5,-2.5)   162 3147.08 3363.05     negative</span></span>
<span><span class="co">#&gt; 5        5   [-2.5,0)  3744 2711.34 2859.10     positive</span></span>
<span><span class="co">#&gt; 6        6    [0,2.5)  5703 1749.51 1908.28     positive</span></span>
<span><span class="co">#&gt; 7        7    [2.5,5) 11802 1984.25 2176.00     positive</span></span>
<span><span class="co">#&gt; 8        8    [5,7.5)  7102 1686.81 1831.37     positive</span></span>
<span><span class="co">#&gt; 9        9   [7.5,10)  1719 1354.70 1482.74     positive</span></span>
<span><span class="co">#&gt; 10      10    [10,20)    57 1657.45 1744.46     negative</span></span></code></pre></div>
<div class="figure">
<img src="cormus_domestica_tmp_files/figure-html/result_plot-1.png" alt="Figure 3 - The climatic niche of Cormus domestica, as defined by a positive association with a mean January temperature of -2.5C - 10C" width="100%"><p class="caption">
Figure 3 - The climatic niche of Cormus domestica, as defined by a
positive association with a mean January temperature of -2.5C - 10C
</p>
</div>
<p>By visually inspecting Figure 3 we can see that occurrences of
<em>Cormus domestica</em> are mostly restricted to the associated
habitat as defined by a mean January temperature of -2.5C - 10C.
However, <em>Cormus domestica</em> does not exist in all areas
experiencing a mean January temperature of -2.5C - 10C, additionally
there are a number of occurrences outside these areas. The next step
assessing in the climatic niche of <em>Cormus domestica</em> would be to
repeat the above analysis for more environmental variables, which is
beyond the scope of this minimal example.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Chamberlain SA, Boettiger C. 2017. R Python, and Ruby clients for
GBIF species occurrence data. PeerJ Preprints 5:e3304v1 <a href="doi:10.7287/peerj.preprints.3304v1" class="uri">doi:10.7287/peerj.preprints.3304v1</a></p>
<p>De Rigo, D., Caudullo, G., Houston Durrant, T. and San-Miguel-Ayanz,
J., 2016. The European Atlas of Forest Tree Species: modelling, data and
information on forest tree species. <em>European Atlas of Forest Tree
Species</em>, p.e01aa69. <a href="doi:10.2788/4251" class="uri">doi:10.2788/4251</a></p>
<p>New, M., Lister, D., Hulme, M. and Makin, I., 2002. A high-resolution
data set of surface climate over global land areas. <em>Climate
research</em>, <em>21</em>(1), pp.1-25. <a href="doi:10.3354/cr021001" class="uri">doi:10.3354/cr021001</a></p>
<p>Rotach, P., 2003. EUFORGEN Technical Guidelines for genetic
conservation and use for service tree (Sorbus domestica). Bioversity
International.</p>
<p>South A (2022). <em>rnaturalearth: World Map Data from Natural
Earth</em>. <a href="https://docs.ropensci.org/rnaturalearth" class="external-link uri">https://docs.ropensci.org/rnaturalearth</a> (website) <a href="https://github.com/ropensci/rnaturalearth." class="external-link uri">https://github.com/ropensci/rnaturalearth.</a></p>
<p>Sparks, (2017). getCRUCLdata: Use and Explore CRU CL v. 2.0
Climatology Elements in R. Journal of Open Source Software, 2(12), 230,
<a href="doi:10.21105/joss.00230" class="uri">doi:10.21105/joss.00230</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Maximilian H.K. Hesselbarth, Marco Sciaini, Chris Wudel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
